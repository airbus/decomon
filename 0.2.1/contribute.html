<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contributing &mdash; decomon 0.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=37f418d5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/versions.js?v=59b132a2"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="decomon.types package" href="api/decomon.types.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            decomon
          </a>
              <div class="version">
                0.2.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-your-development-environment">Setting up your development environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python-3-9-environment">Python 3.9+ environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keras-3">Keras 3+</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-from-source-in-developer-mode">Installing from source in developer mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-docs-locally">Building the docs locally</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-the-documentation-dependencies">Install the documentation dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-environment-variables-for-notebook-github-links">Define environment variables for notebook github links</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-the-docs">Build the docs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-unit-tests">Running unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-notebooks-as-tests">Running notebooks as tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#guidelines-to-follow-when-preparing-a-contribution">Guidelines to follow when preparing a contribution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coding-style-and-code-linting">Coding style and code linting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#annotations">Annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notebooks">Notebooks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#title-and-description-extraction">Title and description extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#colab-specificities">Colab specificities</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-unit-tests">Adding unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-the-documentation">Writing the documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#in-code-docstrings">In-code docstrings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#doc-pages">Doc pages</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#submitting-pull-requests">Submitting pull requests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prior-checks">Prior checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reorganizing-commits">Reorganizing commits</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/airbus/decomon">Github</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">decomon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Contributing</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Link to this heading"></a></h1>
<p>We welcome all contributions to decomon.</p>
<p>You can help by:</p>
<ul class="simple">
<li><p>fixing bugs (see <a class="reference external" href="https://github.com/airbus/decomon/issues">issues</a> with label “bug”),</p></li>
<li><p>improving the documentation,</p></li>
<li><p>adding and improving educational notebooks in <code class="docutils literal notranslate"><span class="pre">tutorials/</span></code>.</p></li>
</ul>
<p>This is not exhaustive.</p>
<p>The project is hosted on <a class="reference external" href="https://github.com/airbus/decomon">https://github.com/airbus/decomon</a>.
Contributions to the repository are made by submitting pull requests.</p>
<p>This guide is organized as follows:</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#setting-up-your-development-environment" id="id1">Setting up your development environment</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id2">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#installing-from-source-in-developer-mode" id="id3">Installing from source in developer mode</a></p></li>
<li><p><a class="reference internal" href="#building-the-docs-locally" id="id4">Building the docs locally</a></p></li>
<li><p><a class="reference internal" href="#running-unit-tests" id="id5">Running unit tests</a></p></li>
<li><p><a class="reference internal" href="#running-notebooks-as-tests" id="id6">Running notebooks as tests</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#guidelines-to-follow-when-preparing-a-contribution" id="id7">Guidelines to follow when preparing a contribution</a></p>
<ul>
<li><p><a class="reference internal" href="#coding-style-and-code-linting" id="id8">Coding style and code linting</a></p></li>
<li><p><a class="reference internal" href="#annotations" id="id9">Annotations</a></p></li>
<li><p><a class="reference internal" href="#notebooks" id="id10">Notebooks</a></p></li>
<li><p><a class="reference internal" href="#adding-unit-tests" id="id11">Adding unit tests</a></p></li>
<li><p><a class="reference internal" href="#writing-the-documentation" id="id12">Writing the documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#submitting-pull-requests" id="id13">Submitting pull requests</a></p>
<ul>
<li><p><a class="reference internal" href="#prior-checks" id="id14">Prior checks</a></p></li>
<li><p><a class="reference internal" href="#reorganizing-commits" id="id15">Reorganizing commits</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="setting-up-your-development-environment">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Setting up your development environment</a><a class="headerlink" href="#setting-up-your-development-environment" title="Link to this heading"></a></h2>
<section id="prerequisites">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h3>
<section id="python-3-9-environment">
<h4>Python 3.9+ environment<a class="headerlink" href="#python-3-9-environment" title="Link to this heading"></a></h4>
<p>The use of a virtual environment is recommended, and you will need to ensure that the environment use a Python version
greater than 3.9.
This can be achieved for instance either by using <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a> or by using <a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a> (or <a class="reference external" href="https://github.com/pyenv-win/pyenv-win">pyenv-win</a> on windows)
and <a class="reference external" href="https://docs.python.org/fr/3/library/venv.html">venv</a> module.</p>
<p>The following examples show how to create a virtual environment with Python version 3.10.13 with the mentioned methods.</p>
<section id="with-conda-all-platforms">
<h5>With conda (all platforms)<a class="headerlink" href="#with-conda-all-platforms" title="Link to this heading"></a></h5>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span><span class="k">do</span>-env<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.10.13
conda<span class="w"> </span>activate<span class="w"> </span><span class="k">do</span>-env
</pre></div>
</div>
</section>
<section id="with-pyenv-venv-linux-macos">
<h5>With pyenv + venv (Linux/MacOS)<a class="headerlink" href="#with-pyenv-venv-linux-macos" title="Link to this heading"></a></h5>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>install<span class="w"> </span><span class="m">3</span>.10.13
pyenv<span class="w"> </span>shell<span class="w"> </span><span class="m">3</span>.10.13
python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span><span class="k">do</span>-venv
<span class="nb">source</span><span class="w"> </span><span class="k">do</span>-venv/bin/activate
</pre></div>
</div>
</section>
<section id="with-pyenv-win-venv-windows">
<h5>With pyenv-win + venv (Windows)<a class="headerlink" href="#with-pyenv-win-venv-windows" title="Link to this heading"></a></h5>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pyenv<span class="w"> </span>install<span class="w"> </span><span class="m">3</span>.10.13
pyenv<span class="w"> </span>shell<span class="w"> </span><span class="m">3</span>.10.13
python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span><span class="k">do</span>-venv
<span class="k">do</span>-venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</pre></div>
</div>
</section>
</section>
<section id="keras-3">
<h4>Keras 3+<a class="headerlink" href="#keras-3" title="Link to this heading"></a></h4>
<p>Decomon relies on <a class="reference external" href="https://keras.io/keras_3/">Keras 3</a> which allows the use of several backends: Tensorflow, PyTorch, and JAX.</p>
<p>To use it, you need to install at least one of the backends (refer to the documentation of each backend).
You can find the version needed to be compatible with keras 3 in
the <a class="reference external" href="https://keras.io/getting_started/#compatibility-matrix">Keras 3 compatibility matrix</a></p>
<p>You choose the backend used at runtime by setting the environment variable <code class="docutils literal notranslate"><span class="pre">KERAS_BACKEND</span></code>. Read more about it in
<a class="reference external" href="https://keras.io/getting_started/#configuring-your-backend">Keras documentation</a>.</p>
<section id="warning-when-using-backend-tensorflow-2-15">
<h5>Warning when using backend Tensorflow 2.15<a class="headerlink" href="#warning-when-using-backend-tensorflow-2-15" title="Link to this heading"></a></h5>
<p>When installing Tensorflow 2.15, the version 2.15 of Keras will be installed automatically. Be sure to get back keras 3
by fully uninstalling Keras then reinstalling Keras 3:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>uninstall<span class="w"> </span>keras
pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;keras&gt;=3&quot;</span>
</pre></div>
</div>
<p>The problem will not occur starting from tensorflow 2.16.</p>
</section>
</section>
</section>
<section id="installing-from-source-in-developer-mode">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Installing from source in developer mode</a><a class="headerlink" href="#installing-from-source-in-developer-mode" title="Link to this heading"></a></h3>
<p>We use the option <code class="docutils literal notranslate"><span class="pre">--editable</span></code> (or <code class="docutils literal notranslate"><span class="pre">-e</span></code>) of <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>.</p>
<blockquote>
<div><p><strong>Note</strong>: you need a version of pip &gt;=21.3 to be able to install in editable mode a project using a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file.</p>
</div></blockquote>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/airbus/decomon.git
<span class="nb">cd</span><span class="w"> </span>decomon
pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>pip
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
</section>
<section id="building-the-docs-locally">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Building the docs locally</a><a class="headerlink" href="#building-the-docs-locally" title="Link to this heading"></a></h3>
<p>The documentation is using <a class="reference external" href="https://www.sphinx-doc.org/en/master/index.html">Sphinx</a> to generate
the html pages, and in particular the autogenerated API doc from in-code docstrings.</p>
<section id="install-the-documentation-dependencies">
<h4>Install the documentation dependencies<a class="headerlink" href="#install-the-documentation-dependencies" title="Link to this heading"></a></h4>
<p>See <a class="reference internal" href="#installing-from-source-in-developer-mode">above</a> to install decomon in developer mode, and then</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>docs/requirements.txt
</pre></div>
</div>
</section>
<section id="define-environment-variables-for-notebook-github-links">
<h4>Define environment variables for notebook github links<a class="headerlink" href="#define-environment-variables-for-notebook-github-links" title="Link to this heading"></a></h4>
<p>In order to define appropriate github and colab links for notebooks,
we need several environment variables:</p>
<ul class="simple">
<li><p>AUTODOC_NOTEBOOKS_REPO_URL: url of the content repository for the notebooks</p></li>
<li><p>AUTODOC_NOTEBOOKS_BRANCH: branch containing the notebooks</p></li>
</ul>
<p>For instance:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">current_repo_url_withdotgit</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>remote<span class="w"> </span>get-url<span class="w"> </span>origin<span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AUTODOC_NOTEBOOKS_REPO_URL</span><span class="o">=</span><span class="si">${</span><span class="nv">current_repo_url_withdotgit</span><span class="p">/.git/</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AUTODOC_NOTEBOOKS_BRANCH</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>branch<span class="w"> </span>--show-current<span class="k">)</span>
</pre></div>
</div>
</section>
<section id="build-the-docs">
<h4>Build the docs<a class="headerlink" href="#build-the-docs" title="Link to this heading"></a></h4>
<p>On Linux or Mac, or with <a class="reference external" href="https://gitforwindows.org/">git-bash</a> on windows, make the documentation with</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>docs
<span class="c1"># generate api doc source files</span>
rm<span class="w"> </span>source/api/decomon*.rst
sphinx-apidoc<span class="w"> </span>-o<span class="w"> </span>source/api<span class="w"> </span>-f<span class="w"> </span>-T<span class="w"> </span>../src/decomon
<span class="c1"># generate available notebooks list</span>
python<span class="w"> </span>generate_nb_index.py
<span class="c1"># remove previous build</span>
rm<span class="w"> </span>-rf<span class="w"> </span>build
<span class="c1"># build doc html pages</span>
sphinx-build<span class="w"> </span>-M<span class="w"> </span>html<span class="w"> </span><span class="nb">source</span><span class="w"> </span>build
</pre></div>
</div>
<p>The index of the built documentation is then available at <code class="docutils literal notranslate"><span class="pre">build/html/index.html</span></code>
from the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> repository. You can for instance browse the documentation by running</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-d<span class="w"> </span>build/html
</pre></div>
</div>
<p>and go to <a class="reference external" href="http://localhost:8000/">http://localhost:8000/</a>. Doing this, rather than just opening <code class="docutils literal notranslate"><span class="pre">index.html</span></code> directly in you browser,
make javascript work properly.</p>
<p>On windows with standard command prompt, the same lines work except that you have to use <code class="docutils literal notranslate"><span class="pre">rm</span></code> equivalent command to remove files and directories.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sphinx-apidoc</span></code> is used to generate the source files for api doc. It is necessary to launch it
each time a new subpackage/module is added to the code.</p></li>
<li><p>The line before is useful to avoid having source file corresponding to previous subpackage/module
that have been removed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generate_nb_index.py</span></code> update the list of notebooks in the generated file notebooks.md that is
the source file of notebooks page. The command has to be launched when a new notebook is added.</p></li>
<li><p>The last command actually build the html outputs and is required each time a doc page has a change
(either beacause a source file has changed or the docstrings in the code have been modified).</p></li>
<li><p>To update the doc faster when testing changes, launch only the last command
without the previous <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">[...]</span></code>.</p></li>
</ul>
</div>
</section>
</section>
<section id="running-unit-tests">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Running unit tests</a><a class="headerlink" href="#running-unit-tests" title="Link to this heading"></a></h3>
<p>The unit tests are gathered in <code class="docutils literal notranslate"><span class="pre">tests/</span></code> folder and can can be launched with <a class="reference external" href="https://tox.wiki/">tox</a>.</p>
<p>Tox manage the creation of its own virtual environments with different versions of python,
so do not use the virtual environment where you installed the library.</p>
<p>Install tox (for instance in a separate virtual environment):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>tox_venv
.<span class="w"> </span>tox_venv/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>pip
pip<span class="w"> </span>install<span class="w"> </span>tox
</pre></div>
</div>
<p>Launch the test suite:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tox
</pre></div>
</div>
<p>If all python versions are not available or if you want to test only on a given version,
specify the tox environment you want to test on. For instance:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>l<span class="w">  </span><span class="c1"># list all environments available</span>
tox<span class="w"> </span>run<span class="w"> </span>-e<span class="w"> </span>py39-torch<span class="w">  </span><span class="c1"># pytorch backend</span>
tox<span class="w"> </span>run<span class="w"> </span>-e<span class="w"> </span>py39-tf<span class="w">  </span><span class="c1"># tensorflow backend</span>
</pre></div>
</div>
<p>You can also run a specific test, let say the function <code class="docutils literal notranslate"><span class="pre">test_get_adv_box_1d</span></code> from file
“tests/test_wrapper.py” like that:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>run<span class="w"> </span>-e<span class="w"> </span>py39-torch<span class="w"> </span>--<span class="w"> </span>tests/test_wrapper.py::test_get_adv_box_1d
</pre></div>
</div>
<p>Under the hood, tox is actually calling <a class="reference external" href="https://docs.pytest.org/">pytest</a> to perform the tests. You could also directly
call it (after installing it in your development environment) with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>tests<span class="w"> </span>-v
</pre></div>
</div>
</section>
<section id="running-notebooks-as-tests">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Running notebooks as tests</a><a class="headerlink" href="#running-notebooks-as-tests" title="Link to this heading"></a></h3>
<p>One can test programmatically that notebooks are not broken thanks to <a class="reference external" href="https://github.com/treebeardtech/nbmake">nbmake</a> extension for pytest.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>nbmake
pytest<span class="w"> </span>--nbmake<span class="w"> </span>tutorials<span class="w"> </span>-v
</pre></div>
</div>
</section>
</section>
<section id="guidelines-to-follow-when-preparing-a-contribution">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Guidelines to follow when preparing a contribution</a><a class="headerlink" href="#guidelines-to-follow-when-preparing-a-contribution" title="Link to this heading"></a></h2>
<section id="coding-style-and-code-linting">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Coding style and code linting</a><a class="headerlink" href="#coding-style-and-code-linting" title="Link to this heading"></a></h3>
<p>To help maintaining the same coding style across the project, some code linters are used via <a class="reference external" href="https://pre-commit.com/">pre-commit</a>.</p>
<p>It is used by CI to run checks at each push, but can also be used locally.</p>
<p>Once installed, you can run it on all files with</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files
</pre></div>
</div>
<p>Beware that doing so, you are actually modifying the files.</p>
<p>You can also use it when committing:</p>
<ul class="simple">
<li><p>stage your changes: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">your_files</span></code>,</p></li>
<li><p>run pre-commit on the staged files: <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">run</span></code>,</p></li>
<li><p>check the changes made,</p></li>
<li><p>accept them by adding modified files: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">-u</span></code>,</p></li>
<li><p>commit: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code>.</p></li>
</ul>
<p>This can also be done automatically at each commit if you add pre-commit to git hooks with <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code>.
Beware that when doing so,</p>
<ul class="simple">
<li><p>the changes will be refused if pre-commit actually modifies the files,</p></li>
<li><p>you can then accept the modifications with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">-u</span></code>,</p></li>
<li><p>you can still force a commit that violates pre-commit checks with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-n</span></code> or <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">--no-verify</span></code>.</p></li>
</ul>
<p>If you prefer run pre-commit manually, you can remove the hooks with <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">uninstall</span></code>.</p>
</section>
<section id="annotations">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Annotations</a><a class="headerlink" href="#annotations" title="Link to this heading"></a></h3>
<p>The code is now fully annotated, and <a class="reference external" href="https://mypy-lang.org/">mypy</a> is used to statically type checking it during CI workflow.
So when you write new code, you should add the appropriate annotations to your functions and methods.</p>
<p>You can then test it directly with mypy</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>mypy
mypy
</pre></div>
</div>
<p>This check is also part of the tox test suite, via the tox environment “type”:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tox<span class="w"> </span>-e<span class="w"> </span><span class="nb">type</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="#running-unit-tests">section about unit tests</a> for more information on tox.</p>
</section>
<section id="notebooks">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Notebooks</a><a class="headerlink" href="#notebooks" title="Link to this heading"></a></h3>
<p>We try to give some introductory examples via notebooks available in the corresponding <code class="docutils literal notranslate"><span class="pre">tutorials/</span></code> directory.</p>
<section id="title-and-description-extraction">
<h4>Title and description extraction<a class="headerlink" href="#title-and-description-extraction" title="Link to this heading"></a></h4>
<p>The list of these notebooks is automatically inserted in the documentation with a title and a description.
These are actually extracted from the first cell. To enable that, each notebook should</p>
<ul class="simple">
<li><p>start with a markdown cell,</p></li>
<li><p>its first line being the title starting with one number sign (”# “),</p></li>
<li><p>the remaining lines being used as the description.</p></li>
<li><p>you can add lines that will be seen in notebook but not extracted in the description by wrapping them
into <code class="docutils literal notranslate"><span class="pre">&lt;decomonlinks&gt;&lt;/decomonlinks&gt;</span></code>  (see first cells of existing tutorials)</p></li>
</ul>
<p>For instance:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gh"># Great notebook title</span>

A quick description of the main features of the notebook.
Can be on several lines.

&lt;decomonlinks&gt;
<span class="k">-</span><span class="w"> </span>&lt;a href=&quot;https://airbus.github.io/decomon&quot;&gt; Documentation &lt;/a&gt;
<span class="k">-</span><span class="w"> </span>&lt;a href=&quot;https://github.com/airbus/decomon&quot;&gt; Github &lt;/a&gt;
<span class="k">-</span><span class="w"> </span>&lt;a href=&quot;https://airbus.github.io/decomon/main/tutorials.html &quot;&gt; Tutorials &lt;/a&gt;
&lt;/decomonlinks&gt;

Can include a nice thumbnail.
![<span class="nt">Notebook_thumbnail</span>](<span class="na">https://upload.wikimedia.org/wikipedia/commons/2/27/MnistExamples.png</span>)
</pre></div>
</div>
</section>
<section id="colab-specificities">
<h4>Colab specificities<a class="headerlink" href="#colab-specificities" title="Link to this heading"></a></h4>
<p>In order to make it work on colab, you should also adding a cell that, after testing that the notebook is run on colab,
install decomon and other necessary dependencies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># On Colab: install the library</span>
<span class="n">on_colab</span> <span class="o">=</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">())</span>
<span class="k">if</span> <span class="n">on_colab</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>  <span class="c1"># noqa: avoid having this import removed by pycln</span>

    <span class="c1"># install dev version for dev doc, or release version for release doc</span>
    <span class="err">!</span><span class="p">{</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">}</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">pip</span>
    <span class="err">!</span><span class="p">{</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">}</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">airbus</span><span class="o">/</span><span class="n">decomon</span><span class="nd">@main</span><span class="c1">#egg=decomon</span>
</pre></div>
</div>
<p>When deployed in the release doc, the pip spec for decomon will be automatically updated to “decomon==x.y.z”,
“x.y.z” being the appropriate version.</p>
</section>
</section>
<section id="adding-unit-tests">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Adding unit tests</a><a class="headerlink" href="#adding-unit-tests" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Whenever adding some code, think to add some tests to the <code class="docutils literal notranslate"><span class="pre">tests/</span></code> folder.</p></li>
<li><p>Whenever fixing a bug, think to add a test that crashes before fixing the bug and does not afterwards.</p></li>
</ul>
<p>Follow <a class="reference internal" href="#running-unit-tests">above instructions</a> to run them with pytest.</p>
</section>
<section id="writing-the-documentation">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Writing the documentation</a><a class="headerlink" href="#writing-the-documentation" title="Link to this heading"></a></h3>
<section id="in-code-docstrings">
<h4>In-code docstrings<a class="headerlink" href="#in-code-docstrings" title="Link to this heading"></a></h4>
<p>The API is self-documented thanks to in-code docstrings and annotations. Whenever adding/fixing some code, you should add/update
doctrings and annotations.</p>
<p>In order to generate properly the API doc, some guidelines should be followed:</p>
<ul>
<li><p>Docstrings should follow <a class="reference external" href="https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings">Google style</a> docstrings
(see this <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/example_google.html#example-google">example</a>),
parsed thanks to <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html?highlight=napoleon#module-sphinx.ext.napoleon">napoleon extension</a>.</p></li>
<li><p>As we use type annotations in the code, types hints should not be added to the docstrings in order to avoid duplicates,
and potentially inconsistencies.</p></li>
<li><p>You should use <a class="reference external" href="https://peps.python.org/pep-0484/">annotations</a> to explicit the types of public variables and of the inputs, outputs of public methods/functions.</p></li>
<li><p>Docstrings should also follow <a class="reference external" href="https://peps.python.org/pep-0257/">PEP-257</a> which can be checked
thanks to <a class="reference external" href="https://www.pydocstyle.org/en/stable/">pydocstyle</a> tool.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pydocstyle
pydocstyle<span class="w"> </span>decomon
</pre></div>
</div>
</li>
</ul>
</section>
<section id="doc-pages">
<h4>Doc pages<a class="headerlink" href="#doc-pages" title="Link to this heading"></a></h4>
<p>Natively, sphinx is meant to parse <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html">reStructuredText files</a>.</p>
<p>To be able to directly reuse materials already written in markdown format, we use here the <a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/intro.html">myST extension</a>,
that allows to write <a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/syntax/syntax.html">makdown files</a>.</p>
<p>In markdown files, we can still write sphinx directives and roles as explained in <a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/syntax/roles-and-directives.html">myST documentation</a>.
For instance a sphinx table of contents tree can be inserted in a markodown file with a code block like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>```{toctree}
---
maxdepth: 2
caption: Contents
---
install
getting_started
notebooks
api/modules
contribute
```
</pre></div>
</div>
</section>
</section>
</section>
<section id="submitting-pull-requests">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Submitting pull requests</a><a class="headerlink" href="#submitting-pull-requests" title="Link to this heading"></a></h2>
<p>When you think you are ready to merge your modifications into the main repository, you will have to open a pull request (PR).
We can summarize the process as follows:</p>
<ul class="simple">
<li><p>Fork the repository on github.</p></li>
<li><p>Clone your fork on your computer.</p></li>
<li><p>Make your changes and push them to your fork.</p></li>
<li><p>Do the necessary checks (see <a class="reference internal" href="#prior-checks">below</a>).</p></li>
<li><p>Reorganize your commits (see <a class="reference internal" href="#reorganizing-commits">below</a>).</p></li>
<li><p>Submit your pull request (see <a class="reference external" href="https://help.github.com/articles/creating-a-pull-request-from-a-fork/">github documentation</a>).</p></li>
<li><p>See if all CI checks passed on your PR.</p></li>
<li><p>Wait for a review.</p></li>
<li><p>Take the comments and required changes into account.</p></li>
</ul>
<p>Note that a PR needs at least one review by a core developer to be merged.</p>
<p>You may want to add a reference to the main repository to fetch from it and (re)base your changes on it:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>upstream<span class="w"> </span>https://github.com/airbus/decomon
</pre></div>
</div>
<p>This <a class="reference external" href="https://medium.com/google-developer-experts/how-to-pull-request-d75ac81449a5">post</a> points out good practices to follow
to submit great pull requests and review them efficiently.</p>
<section id="prior-checks">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Prior checks</a><a class="headerlink" href="#prior-checks" title="Link to this heading"></a></h3>
<p>Before submitting your pull request, think to</p>
<ul class="simple">
<li><p><a class="reference internal" href="#running-unit-tests">run the unit tests</a>,</p></li>
<li><p><a class="reference internal" href="#building-the-docs-locally">check the documentation locally</a> if you modified it,</p></li>
<li><p>check you respect the coding styles by <a class="reference internal" href="#coding-style-and-code-linting">running linters</a>,</p></li>
<li><p>check that mypy is happy with <a class="reference internal" href="#annotations">your annotations</a>.</p></li>
</ul>
<p>If you do not, you will still be able to see the status of your PR as CI will do these checks for you.</p>
</section>
<section id="reorganizing-commits">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Reorganizing commits</a><a class="headerlink" href="#reorganizing-commits" title="Link to this heading"></a></h3>
<p>On your way to implement your contribution, you will probably have lots of commits,
some modifying other ones from the same PR, or only modifying the code style.</p>
<p>At the end of your work, consider reorganizing them by</p>
<ul class="simple">
<li><p>squashing them into one or only a few logical commits,</p></li>
<li><p>having a separate commit to reformat previous existing code if necessary,</p></li>
<li><p>rewritting commit messages so that it explains the changes made and why, the “how” part being explained by the code itself
(see this <a class="reference external" href="https://chris.beams.io/posts/git-commit/">post</a> about what a commit message should and should not contain),</p></li>
<li><p>rebasing on upstream repository main branch if it diverged too much by the time you finished.</p></li>
</ul>
<p>You can use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span> <span class="pre">-i</span></code> to do that, as explained in <a class="reference external" href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History">git documentation</a>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api/decomon.types.html" class="btn btn-neutral float-left" title="decomon.types package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Airbus.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions</span>
      v: 0.2.1
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="docs-versions">
      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>